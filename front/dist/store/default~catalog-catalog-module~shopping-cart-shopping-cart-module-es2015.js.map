{"version":3,"sources":["./src/app/shopping-cart/shopping-cart-routing.module.ts","./src/app/shopping-cart/shopping-cart.module.ts","./src/app/shopping-cart/shopping-cart.component.ts","./src/app/shopping-cart/shopping-cart.component.html","./src/app/get-products.service.ts"],"names":[],"mappings":"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","file":"default~catalog-catalog-module~shopping-cart-shopping-cart-module-es2015.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { ShoppingCartComponent } from './shopping-cart.component';\r\n\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: ShoppingCartComponent\r\n  },\r\n  {\r\n    path: 'products',\r\n    component: ShoppingCartComponent\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class ShoppingCartRoutingModule { }\r\n","import { ShoppingCartRoutingModule } from './shopping-cart-routing.module';\r\nimport { ProductState } from '../../shared/states/product-state';\r\nimport { NgxsModule } from '@ngxs/store';\r\nimport { AppModule } from '../app.module';\r\nimport { ShoppingCartComponent } from './shopping-cart.component';\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ShoppingCartComponent,\r\n  ],\r\n  imports: [\r\n    // AppModule,\r\n    CommonModule,\r\n    // NgxsModule,\r\n    // NgxsModule.forRoot([\r\n    //   ProductState\r\n    // ]),\r\n    ShoppingCartRoutingModule\r\n  ],\r\n  providers: [],\r\n  exports: [ShoppingCartComponent],\r\n  // bootstrap: [AppComponent]\r\n})\r\nexport class ShoppingCartModule { }\r\n","import { ProductService } from './../get-products.service';\r\nimport { Product } from './../../shared/models/products';\r\nimport { DelProduct, BuyProduct } from './../../shared/actions/product-action';\r\nimport { ProductState } from './../../shared/states/product-state';\r\nimport { Store } from '@ngxs/store';\r\nimport { Observable, of, timer } from 'rxjs';\r\nimport { animate, state, style, transition, trigger } from '@angular/animations';\r\nimport { Component, HostBinding, OnInit, Renderer2, ElementRef } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\n\r\n@Component({\r\n  selector: 'app-shopping-cart',\r\n  templateUrl: './shopping-cart.component.html',\r\n  styleUrls: ['./shopping-cart.component.scss'],\r\n\r\n})\r\nexport class ShoppingCartComponent implements OnInit {\r\n\r\n  listProduct$: Observable<Product>;\r\n  nbProducts$: Observable<number>;\r\n  priceProducts$: Observable<number>;\r\n  products: Product[];\r\n  // @HostBinding('class.homeLogo') isHome:boolean = false;\r\n  public empty: boolean = true;\r\n  public buying:boolean = false;\r\n  public bought: boolean = false;\r\n  public errorBuying: boolean = false;\r\n  ;\r\n  public responseMessage: string=null;\r\n  \r\n  constructor(private productService: ProductService, private router: Router, private _renderer: Renderer2, private _elemRef : ElementRef, private store: Store) {\r\n    // i want different styles depending on the route, since the shopping cart is shown on the store page (like amazon)\r\n    if(this.router.url == '/cart') {\r\n      this._renderer.setAttribute(this._elemRef.nativeElement, 'id','shopping-cart-page' );\r\n    }\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    \r\n    this.listProduct$ = this.store.select(state => state.listProducts.products);\r\n    // Solution 1\r\n    this.nbProducts$ = this.store.select(ProductState.getNbProducts);\r\n    this.priceProducts$ = this.store.select(ProductState.getFullPriceProducts);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n  }\r\n\r\n  onClickRemove(product) {\r\n    this.removeItem(product);\r\n  }\r\n  removeItem(product) {\r\n    this.store.dispatch(new DelProduct(product));\r\n  }\r\n\r\n  buyProducts(products) {\r\n    products.subscribe(products => this.products = products);\r\n    this.buying = true;\r\n    this.productService.buyProducts(this.products).subscribe((response) => {\r\n      if(response.success)\r\n      {\r\n        this.bought = true;\r\n        this.store.dispatch(new BuyProduct(products));\r\n      }\r\n      else {\r\n        this.errorBuying = true;\r\n      }\r\n      this.responseMessage = response.data;\r\n    })\r\n    let timer$ = timer(3000);\r\n    timer$.subscribe(t=> {\r\n      this.buying = false;\r\n    });\r\n  }\r\n}\r\n","<div>\r\n\r\n    <div class=\"cart-content\">\r\n        <h1 class=\"cart-title\">Your Cart <i class=\"fa fa-shopping-cart\" aria-hidden=\"true\"></i></h1>\r\n        <div class=\"cart-list\">\r\n            <span *ngIf=\"!(nbProducts$ |async)\">Your cart is empty... <i class=\"fa fa-frown-o smiley-face\" aria-hidden=\"true\"></i></span>\r\n            <div class=\"cart-product-list cart-container\">\r\n                <p>Total products : {{ nbProducts$ | async }} | Price : {{ priceProducts$ | async}}€</p>\r\n                <div class=\"cart-page-recap\">\r\n                    <div>\r\n                        <h3>Recap</h3>\r\n                    </div>\r\n                    <div class=\"cart-recap-info\">\r\n                        <span>Total products : {{nbProducts$ | async}}</span>\r\n                        <span>Total amount : {{priceProducts$ | async}}€ </span>\r\n                        <button (click)=\"buyProducts(listProduct$)\" [disabled]=\"!(nbProducts$| async )\">Go to checkout</button>\r\n                    </div>\r\n                </div>\r\n                <div class=\"cart-product-list\">\r\n                    <div *ngFor=\"let item of (listProduct$ | async)\" class=\"cart-product\">\r\n                        <div class=\"cart-product-img\">\r\n                            <img class=\"product-img\" src=\"../../assets/img/{{item.src}}\" />\r\n                        </div>\r\n                        <div class=\"cart-product-info\">\r\n                            <h4>{{ item.name }}</h4>\r\n                            <div class=\"cart-product-actions\">\r\n                                <span>{{ item.price }}€</span>\r\n                                <button class=\"btn-delete\" (click)=\"onClickRemove(item)\"><i class=\"fa fa-trash\"> </i></button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<div *ngIf=\"buying\" class=\"shopping-cart-buying\">\r\n    <div *ngIf=\"!bought && !errorBuying\">\r\n        <span><i class=\"fa fa-spin fa-spinner\"></i> Purchasing items...</span>\r\n    </div>\r\n    <div *ngIf=\"bought\">Items purchased for {{responseMessage}}€</div>\r\n    <div *ngIf=\"errorBuying\">{{responseMessage}}</div>\r\n</div>","import { ApiService } from './api.service';\r\nimport { EventEmitter } from '@angular/core';\r\nimport { HttpClientModule, HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\n\r\nimport { Product } from '../shared/models/products';\r\nimport { Observable, of, ReplaySubject, Subject, throwError } from 'rxjs';\r\nimport { environment } from '../environments/environment';\r\nimport { catchError, tap, map, filter} from 'rxjs/operators';\r\n@Injectable(\r\n  {\r\n  providedIn: 'root'\r\n  }\r\n)\r\nexport class ProductService extends ApiService {\r\n\r\n  constructor(private hClient: HttpClient) {\r\n    super(hClient);\r\n   }\r\n\r\n  private products: Product[];\r\n  private filteredProducts$: Subject<Product[]> = new ReplaySubject<Product[]>(1);\r\n\r\n  public getProducts(): Observable<Product[]> {\r\n    // return cached products\r\n    if (this.products) {\r\n      return of(this.products);\r\n    }\r\n    // fetch and cache products\r\n    return this.hClient.get(environment.api + '/product/all').pipe(\r\n      tap((data : any) => {\r\n        this.products = data.data;\r\n        this.filteredProducts$.next(this.products);\r\n      }\r\n      )\r\n    );\r\n  }\r\n\r\n  getSearchResults(): Observable<Product[]> {\r\n    return this.filteredProducts$.asObservable();\r\n  }\r\n\r\n  searchProduct(searchTerm: any): Observable<void> {\r\n    return this.getProducts().pipe(\r\n      // using tap to update the stream without changing any data\r\n      tap((products: any) => {\r\n        products = products.filter(product => {\r\n          if(!isNaN(parseFloat(searchTerm)))\r\n          {\r\n            return product.price.toString().includes(searchTerm.toString());\r\n          }\r\n          else {\r\n            return product.name.toLowerCase().includes(searchTerm) || product.description.toLowerCase().includes(searchTerm)\r\n          }\r\n        });\r\n        // updating the stream\r\n        this.filteredProducts$.next(products);\r\n      }),\r\n      map(() => void 0)\r\n    );\r\n  }\r\n\r\n  public getSingleProduct(id): Observable<any> {\r\n    return this.hClient.get(environment.api + '/product/' + id).pipe(\r\n      tap((data : Product) => {\r\n        this.products = data[0];\r\n      })\r\n    );\r\n  }\r\n\r\n\r\n\r\n  priceFilter(status: number): Observable<any[]> {\r\n    return this.getProducts().pipe(\r\n      tap((products : any) => {\r\n        products = products.sort((a,b) => {\r\n          switch (status) {\r\n            case 0:\r\n              return a.price < b.price ? -1 : 1;\r\n              break;\r\n            case 1:\r\n              return a.price > b.price ? -1 : 1;\r\n              break;\r\n            }\r\n        });\r\n        this.filteredProducts$.next(products);\r\n      }\r\n      ),\r\n      map(() => void 0)\r\n      );\r\n  }\r\n\r\n  nameFilter(status : number): Observable<any[]> {\r\n    return this.getProducts().pipe(\r\n      tap((products : any) => {\r\n        products = products.sort((a,b) => {\r\n          switch(status) {\r\n            case 0:\r\n              return a.name < b.name  ? -1 : 1;\r\n              break;\r\n            case 1:\r\n              return a.name > b.name ? -1 : 1;\r\n              break;\r\n          }\r\n        });\r\n        this.filteredProducts$.next(products);\r\n      }),\r\n      map(() => void 0)\r\n    );\r\n  }\r\n\r\n\r\n  buyProducts(products: Product[]) : Observable<any> {\r\n    const  body = new URLSearchParams();\r\n    let price = 0;\r\n    products.forEach(product => {\r\n      price += product.price;\r\n    })\r\n    body.set(\"price\", price.toString());\r\n    return this.hClient.post(environment.api + '/product/buy',body.toString(), this.httpOptions).pipe(\r\n      map((data) => data)\r\n    );\r\n  }\r\n\r\n}\r\n"],"sourceRoot":"webpack:///"}